<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="I want to be able to open multiple terminal windows on my laptop with an SSH connection to a remote machine. This setup combining iTerm2 and tmux seems to work. Note that iTerms2 has built-in tmux...">
        <meta name="keywords" content="">
        <link rel="icon" href="https://0x7df.github.io/favicon.ico">

        <title>Using tmux over ssh in iTerm2 - 0x7df</title>

        <!-- Stylesheets -->
        <link href="https://0x7df.github.io/theme/css/bootstrap.min.css" rel="stylesheet">
        <link href="https://0x7df.github.io/theme/css/fonts.css" rel="stylesheet">
        <link href="https://0x7df.github.io/theme/css/nest.css" rel="stylesheet">
        <link href="https://0x7df.github.io/theme/css/pygment.css" rel="stylesheet">
        <!-- /Stylesheets -->

        <!-- RSS Feeds -->
        <link href="https://0x7df.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="0x7df Full Atom Feed" />
        <!-- /RSS Feeds -->

        <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
          <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
          <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
        <![endif]-->



    </head>

    <body>

        <!-- Header -->
    <div class="header-container gradient">

            <!-- Static navbar -->
            <div class="container">
                <div class="header-nav">
                    <div class="header-logo">
                        <a class="pull-left" href="https://0x7df.github.io/"><img class="mr20" src="https://0x7df.github.io/images/0x7df_60x60.png" alt="logo">0x7df</a>
                    </div>
                    <div class="nav pull-right">
                                <a href="https://0x7df.github.io/">Blog Home</a>
                                <a href="http://0x7df.io">Site Home</a>
                                <a href="https://0x7df.github.io/categories.html">Categories</a>
                            <a  href="https://0x7df.github.io/pages/0x7df-application.html">0x7df application</a>
                            <a  href="https://0x7df.github.io/pages/about.html">About</a>
                    </div>
                </div>
            </div>
            <!-- /Static navbar -->

            <!-- Header -->
    <!-- Header -->
    <div class="container header-wrapper">
        <div class="row">
              <div class="col-lg-12">
                  <div class="header-content">
                      <h1 class="header-title">Using tmux over ssh in iTerm2</h1>
                      <p class="header-date">By <a href="https://0x7df.github.io/author/0x7df.html">0x7df</a>, Sun 11 October 2020, modified Sun 11 October 2020, in category <a href="https://0x7df.github.io/category/misc.html">Misc</a></p>
                      <div class="header-underline"></div>
                      <div class="clearfix"></div>
                      <p class="pull-right header-tags">
                          <span class="glyphicon glyphicon-tags mr5" aria-hidden="true"></span>
                      </p>
                  </div>
              </div>
        </div>
    </div>
    <!-- /Header -->
            <!-- /Header -->

        </div>
        <!-- /Header -->


        <!-- Content -->
    <div class="container content">
        <p>I want to be able to open multiple terminal windows on my laptop with an
SSH connection to a remote machine. This setup combining <a href="https://iterm2.com">iTerm2</a>
and <a href="https://tmuxguide.readthedocs.io">tmux</a> seems to work. Note that iTerms2 has
built-in tmux integration, which is what allows this to work (i.e. it isn't
possible in the native Terminal app on macOS).</p>
<p>Both need to be installed:</p>
<div class="highlight"><pre><span></span><code>brew install tmux
brew cask install iterm2
</code></pre></div>

<p>(iTerm2 is installed from a Cask as it's distributed as a binary; Homebrew
knows to add it to Launchpad.)</p>
<p>Then in iTerm2, <code>ssh</code> to the remote machine using the following:</p>
<div class="highlight"><pre><span></span><code>ssh -t &lt;user&gt;@&lt;remote&gt; <span class="s1">&#39;tmux -CC new -A -s &lt;name&gt;&#39;</span>
</code></pre></div>

<p>(documented
<a href="https://gitlab.com/gnachman/iterm2/-/wikis/tmux-Integration-Best-Practices">here</a>
.) The <code>-s &lt;name&gt;</code> option gives the tmux session a name, and the <code>-A</code> flag
makes tmux reattach to the named session if it already exists; this means the
same command can be used whether creating a new or attaching to an existing
session. (More on detaching and attaching to sessions below.) You might need
to add <code>-u</code> to force tmux to be in UTF-8 mode, depending on the remote system.</p>
<p>A new iTerm2 window opens locally containing a session on the remote
machine <code>&lt;remote&gt;</code>.</p>
<p>The key thing now is, if you open a new window from the 'Shell -&gt; New Window'
menu, or using the <code>Cmd</code>+<code>N</code> shortcut, the new window is connected to the
remote machine automatically. These are proper windows, in the sense of being able
to move them around on the desktop independently of each other (the usual
meaning of 'window') rather than in the sense usually meant in the context of
tmux. With tmux, while you can open multiple 'windows' you can usually only
see one at a time within the single desktop window.</p>
<h2>Detaching and re-attaching</h2>
<p>As is standard with tmux, you can 'detach' the session running on the remote
machine, such that it continues running in the background, even if you log out
of the remote. The you can re-attach after logging back in again. This means
you can continue where you left off if you move from one local client to
another, or just if your SSH connection is lost.</p>
<p>With the tmux integration in iTerm2, if you've opened multiple windows,
then after re-attaching to a session, the original windows re-open.
(In ordinary tmux, re-attaching to a session restores the <em>tmux</em> windows and
panes, and picks up where you left off, but as before, all this will be in the
same single desktop window.)</p>
<p>To detach a session, return to the original iTerm2 window where you ran the
<code>ssh</code> command. There will be a menu, like this:</p>
<div class="highlight"><pre><span></span><code>** tmux mode started **

Command Menu
----------------------------
esc    Detach cleanly.
  X    Force-quit tmux mode.
  L    Toggle logging.
  C    Run tmux command.
</code></pre></div>

<p>Pressing <code>Esc</code> here will detach the tmux session and give the following:</p>
<div class="highlight"><pre><span></span><code>Detaching...
Detached
Connection to tems closed.
</code></pre></div>

<p>The SSH connection will be closed. Now run the command:</p>
<div class="highlight"><pre><span></span><code>ssh -t &lt;user&gt;@&lt;remote&gt; &#39;tmux -CC new -A -s &lt;name&gt;&#39;
</code></pre></div>

<p>again, and the connection will be re-established, with the original windows
re-opened, so you can carry on where you left off.</p>
<p>You don't have to manually detach the session; if the SSH connection is lost,
you lose your network connection, or whatever, you can still re-run the
command and re-attach to the tmux session.</p>
<h2>Burying the original iTerm2 session</h2>
<p>Once your remote session is established, the original iTerm2 session where you
ran the <code>ssh ...</code> command is fairly redundant; above we showed that you can
return to that session to access the tmux menu that allows you to detach.
However, you can also detach from the iTerm2 menu bar ('Shell -&gt; tmux -&gt;
Detach') or the keyboard shortcut <code>^</code>+<code>Shift</code>+<code>Cmd</code>+<code>D</code>. iTerm2 allows you
therefore to 'bury' that session so it's not cluttering up your desktop. Go to
'Session -&gt; Bury Session' in that session's menu bar, or use the keyboard
shortcut <code>Opt</code>+<code>Shift</code>+<code>Cmd</code>+<code>B</code>. You can 'dig up' buried sessions from the
'Session -&gt; Buried Sessions' menu. You can also set the default behaviour of
tmux to always bury these sessions, in 'iTerm2 -&gt; Preferences -&gt; General -&gt;
tmux'.</p>


        <h3 id="comments">Comments</h3>

        <div class="form-style">
            <h3>Add comment</h3>
            <form method="POST" action="https://comment-bot-0x7df.herokuapp.com/v2/entry/0x7df/0x7df.github.io/source/comments">
                    <input    name="options[redirect]" type="hidden" value="https://0x7df.github.io/using-tmux-over-ssh-in-iterm2">
                    <input    name="fields[url]"       type="hidden" value="using-tmux-over-ssh-in-iterm2">
                    <input    name="fields[name]"      type="text" placeholder="Name">
                    <textarea name="fields[message]"               placeholder="Comment"></textarea>
                    <input    name="submit"            type="submit" value="Submit"/>
            </form>
        </div>


    </div>
        <!-- /Content --> 

        <!-- Footer -->
        <div class="footer gradient-2">
            <div class="container footer-container ">
                <div class="row">
                    <div class="col-xs-4 col-sm-3 col-md-3 col-lg-3">
                        <div class="footer-title">Sitemap</div>
                        <ul class="list-unstyled">
                            <li><a href="https://0x7df.github.io/archives.html">Archives</a></li>
                            <li><a href="https://0x7df.github.io/tags.html">Tags</a></li>
                            <li><a href="https://0x7df.github.io/authors.html">Authors</a></li>
                            <li><a href="https://0x7df.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">Atom Feed</a></li>
                        </ul>
                    </div>
                    <div class="col-xs-4 col-sm-3 col-md-3 col-lg-3">
                        <div class="footer-title">Social</div>
                        <ul class="list-unstyled">
                            <li><a href="https://twitter.com/@0x7df" target="_blank">Twitter</a></li>
                            <li><a href="https://github.com/0x7df" target="_blank">GitHub</a></li>
                            <li><a href="https://www.facebook.com/0x7df" target="_blank">Facebook</a></li>
                            <li><a href="https://stackoverflow.com/users/4802778" target="_blank">StackOverflow</a></li>
                            <li><a href="http://www.freecodecamp.com/0x7df" target="_blank">FreeCodeCamp</a></li>
                        </ul>
                    </div>
                    <div class="col-xs-4 col-sm-3 col-md-3 col-lg-3">
                        <div class="footer-title">Links</div>
                        <ul class="list-unstyled">
                            <li><a href="http://getpelican.com/" target="_blank">Pelican</a></li>
                            <li><a href="http://python.org/" target="_blank">Python.org</a></li>
                            <li><a href="http://jinja.pocoo.org/" target="_blank">Jinja2</a></li>
                            <li><a href="https://github.com/barrysteyn/pelican_plugin-render_math" target="_blank">Maths plugin</a></li>
                            <li><a href="https://github.com/molivier/nest" target="_blank">Nest theme</a></li>
                            <li><a href="" target="_blank"></a></li>
                            <li><a href="" target="_blank"></a></li>
                            <li><a href="" target="_blank"></a></li>
                        </ul>
                    </div> 
                    <div class="col-xs-12 col-sm-3 col-md-3 col-lg-3">
                        <p class="pull-right text-right">
                            <small><em>Proudly powered by <a href="http://docs.getpelican.com/" target="_blank">pelican</a></em></small><br/>
                            <small><em>Theme and code by <a href="https://github.com/molivier" target="_blank">molivier</a></em></small><br/>
                            <small>&copy; 0x7df 2015</small>
                        </p>
                    </div>
                </div>
            </div>
        </div>
        <!-- /Footer -->
    </body>
</html>